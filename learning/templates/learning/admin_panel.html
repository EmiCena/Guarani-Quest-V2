{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="bento-grid" style="max-width: 1200px; margin: 0 auto;">
  <!-- Header Card -->
  <div class="bento-card bento-accent col-span-12">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h1 style="margin:0;">Panel Administrativo 👑</h1>
        <p style="color:var(--muted);margin:8px 0 0;">Centro de control para gestionar Guaraní Quest</p>
      </div>
      <div class="bento-icon">⚙️</div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="bento-card col-span-12">
    <h3 style="margin-top:0;">📊 Estadísticas Generales</h3>
    <div class="grid grid-4" style="gap:16px;margin-top:16px;">
      <div style="text-align:center;padding:20px;border-radius:12px;background:#f0fdf4;border:1px solid #bbf7d0;">
        <div style="font-size:32px;font-weight:900;color:var(--green);">{{ total_lessons }}</div>
        <div style="color:var(--muted);font-size:14px;">Lecciones Totales</div>
      </div>
      <div style="text-align:center;padding:20px;border-radius:12px;background:#fef3c7;border:1px solid #fde68a;">
        <div style="font-size:32px;font-weight:900;color:#d97706;">{{ published_lessons }}</div>
        <div style="color:var(--muted);font-size:14px;">Lecciones Publicadas</div>
      </div>
      <div style="text-align:center;padding:20px;border-radius:12px;background:#dbeafe;border:1px solid #93c5fd;">
        <div style="font-size:32px;font-weight:900;color:#2563eb;">{{ total_users }}</div>
        <div style="color:var(--muted);font-size:14px;">Usuarios Registrados</div>
      </div>
      <div style="text-align:center;padding:20px;border-radius:12px;background:#f3e8ff;border:1px solid #c084fc;">
        <div style="font-size:32px;font-weight:900;color:#7c3aed;">{{ total_glossary_entries }}</div>
        <div style="color:var(--muted);font-size:14px;">Entradas en Glosario</div>
      </div>
    </div>
  </div>

  <!-- Lesson Creation Section -->
  <div class="bento-card col-span-12">
    <h3 style="margin-top:0;">📚 Gestión de Lecciones</h3>
    <p style="color:var(--muted);margin-bottom:20px;">Crea y administra lecciones de guaraní</p>

    <div class="grid grid-2" style="gap:20px;">
      <!-- Manual Creation -->
      <div style="padding:24px;border-radius:16px;background:#f8fafc;border:2px solid #e5e7eb;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
          <div style="font-size:32px;">✏️</div>
          <div>
            <h4 style="margin:0;">Crear Lección Manual</h4>
            <p style="color:var(--muted);margin:4px 0 0;font-size:14px;">Control total sobre el contenido</p>
          </div>
        </div>
        <p style="color:var(--muted);font-size:14px;margin-bottom:20px;">
          Crea lecciones paso a paso con control completo sobre el contenido, estructura y ejercicios.
          Ideal para contenido específico o cuando prefieres no usar IA.
        </p>
        <div style="display:flex;gap:12px;">
          <a href="{% url 'create_lesson_manual' %}" class="qx-btn" style="flex:1;">Crear Manual</a>
          <a href="{% url 'lessons_overview' %}" class="qx-btn qx-outline" style="flex:1;">Ver Todas</a>
        </div>
      </div>

      <!-- AI Creation -->
      <div style="padding:24px;border-radius:16px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:white;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
          <div style="font-size:32px;">🤖</div>
          <div>
            <h4 style="margin:0;color:white;">Crear con IA</h4>
            <p style="color:rgba(255,255,255,0.8);margin:4px 0 0;font-size:14px;">Generación automática de contenido</p>
          </div>
        </div>
        <p style="color:rgba(255,255,255,0.9);font-size:14px;margin-bottom:20px;">
          Crea lecciones completas automáticamente usando inteligencia artificial.
          Rápido y eficiente para contenido general.
        </p>
        <div style="display:flex;gap:12px;">
          <a href="{% url 'create_lesson_ai' %}" class="qx-btn" style="flex:1;background:white;color:#7c3aed;border-color:white;">Crear con IA</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Management -->
  <div class="bento-card col-span-12">
    <h3 style="margin-top:0;">🛠️ Gestión de Contenido</h3>
    <div class="grid grid-3" style="gap:16px;margin-top:16px;">
      <a href="/admin/" class="admin-card-link" style="text-decoration:none;">
        <div style="padding:20px;border-radius:12px;background:#f0f9ff;border:1px solid #0ea5e9;text-align:center;transition:all 0.2s;">
          <div style="font-size:32px;margin-bottom:8px;">⚙️</div>
          <h4 style="margin:0;color:#0ea5e9;">Django Admin</h4>
          <p style="color:#64748b;font-size:14px;margin:4px 0 0;">Panel administrativo completo</p>
        </div>
      </a>
      <a href="{% url 'glossary' %}" class="admin-card-link" style="text-decoration:none;">
        <div style="padding:20px;border-radius:12px;background:#fef7cd;border:1px solid #f59e0b;text-align:center;transition:all 0.2s;">
          <div style="font-size:32px;margin-bottom:8px;">📖</div>
          <h4 style="margin:0;color:#f59e0b;">Gestión de Glosario</h4>
          <p style="color:#64748b;font-size:14px;margin:4px 0 0;">Administrar palabras y frases</p>
        </div>
      </a>
      <a href="{% url 'exercises' %}" class="admin-card-link" style="text-decoration:none;">
        <div style="padding:20px;border-radius:12px;background:#dcfce7;border:1px solid #16a34a;text-align:center;transition:all 0.2s;">
          <div style="font-size:32px;margin-bottom:8px;">✏️</div>
          <h4 style="margin:0;color:#16a34a;">Ejercicios</h4>
          <p style="color:#64748b;font-size:14px;margin:4px 0 0;">Crear y editar ejercicios</p>
        </div>
      </a>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bento-card col-span-12">
    <h3 style="margin-top:0;">🚀 Acciones Rápidas</h3>
    <div class="grid grid-4" style="gap:16px;margin-top:16px;">
      <button onclick="showModal('import_glossary_modal')" class="admin-quick-btn" style="padding:16px;border-radius:12px;background:#f8fafc;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;">
        <div style="font-size:24px;margin-bottom:8px;">📥</div>
        <h5 style="margin:0;color:#374151;">Importar Glosario</h5>
        <p style="color:#6b7280;font-size:12px;margin:4px 0 0;">Cargar palabras desde archivo</p>
      </button>

      <button onclick="showModal('generate_exercises_modal')" class="admin-quick-btn" style="padding:16px;border-radius:12px;background:#f8fafc;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;">
        <div style="font-size:24px;margin-bottom:8px;">🎯</div>
        <h5 style="margin:0;color:#374151;">Generar Ejercicios</h5>
        <p style="color:#6b7280;font-size:12px;margin:4px 0 0;">Crear ejercicios automáticamente</p>
      </button>

      <button onclick="showModal('export_data_modal')" class="admin-quick-btn" style="padding:16px;border-radius:12px;background:#f8fafc;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;">
        <div style="font-size:24px;margin-bottom:8px;">📤</div>
        <h5 style="margin:0;color:#374151;">Exportar Datos</h5>
        <p style="color:#6b7280;font-size:12px;margin:4px 0 0;">Descargar datos del sistema</p>
      </button>

      <button onclick="showModal('system_stats_modal')" class="admin-quick-btn" style="padding:16px;border-radius:12px;background:#f8fafc;border:1px solid #e5e7eb;cursor:pointer;transition:all 0.2s;">
        <div style="font-size:24px;margin-bottom:8px;">📊</div>
        <h5 style="margin:0;color:#374151;">Estadísticas</h5>
        <p style="color:#6b7280;font-size:12px;margin:4px 0 0;">Ver métricas detalladas</p>
      </button>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="bento-card col-span-12">
    <h3 style="margin-top:0;">🕐 Actividad Reciente</h3>
    <div style="margin-top:16px;">
      <div style="padding:16px;border-radius:8px;background:#f1f5f9;margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <strong>Lección creada:</strong> "Saludos básicos en guaraní"
          </div>
          <small style="color:var(--muted);">Hace 2 horas</small>
        </div>
      </div>
      <div style="padding:16px;border-radius:8px;background:#f1f5f9;margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <strong>Nuevo usuario registrado:</strong> maria_garcia
          </div>
          <small style="color:var(--muted);">Hace 4 horas</small>
        </div>
      </div>
      <div style="padding:16px;border-radius:8px;background:#f1f5f9;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <strong>Palabras agregadas al glosario:</strong> 15 nuevas entradas
          </div>
          <small style="color:var(--muted);">Hace 1 día</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals for Quick Actions -->
<div id="import_glossary_modal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-header">
      <h3>📥 Importar Glosario</h3>
      <button onclick="hideModal('import_glossary_modal')" class="modal-close">×</button>
    </div>
    <div class="modal-body">
      <p>Importa palabras y frases desde archivos CSV o JSON para enriquecer el glosario.</p>
      <div style="margin-top:20px;">
        <a href="/admin/learning/glossaryentry/" class="qx-btn" style="width:100%;">Ir al Django Admin</a>
      </div>
    </div>
  </div>
</div>

<div id="generate_exercises_modal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-header">
      <h3>🎯 Generar Ejercicios</h3>
      <button onclick="hideModal('generate_exercises_modal')" class="modal-close">×</button>
    </div>
    <div class="modal-body">
      <p>Usa comandos de gestión para generar ejercicios automáticamente para las lecciones existentes.</p>
      <div style="margin-top:20px;display:flex;gap:12px;">
        <a href="{% url 'create_lesson_ai' %}" class="qx-btn">Crear con IA</a>
        <button onclick="hideModal('generate_exercises_modal')" class="qx-btn qx-outline">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<div id="export_data_modal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-header">
      <h3>📤 Exportar Datos</h3>
      <button onclick="hideModal('export_data_modal')" class="modal-close">×</button>
    </div>
    <div class="modal-body">
      <p>Exporta datos del sistema para análisis o respaldo. Usa los comandos de gestión de Django.</p>
      <div style="margin-top:20px;">
        <button onclick="hideModal('export_data_modal')" class="qx-btn qx-outline" style="width:100%;">Entendido</button>
      </div>
    </div>
  </div>
</div>

<div id="system_stats_modal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:600px;">
    <div class="modal-header">
      <h3>📊 Estadísticas del Sistema</h3>
      <button onclick="hideModal('system_stats_modal')" class="modal-close">×</button>
    </div>
    <div class="modal-body">
      <div style="display:grid;gap:16px;">
        <div style="display:flex;justify-content:space-between;padding:12px;background:#f8fafc;border-radius:8px;">
          <span>Lecciones activas:</span>
          <strong>{{ published_lessons }} / {{ total_lessons }}</strong>
        </div>
        <div style="display:flex;justify-content:space-between;padding:12px;background:#f8fafc;border-radius:8px;">
          <span>Tasa de publicación:</span>
          <strong>{% if total_lessons > 0 %}{{ published_lessons|floatformat:0 }}%{% else %}0%{% endif %}</strong>
        </div>
        <div style="display:flex;justify-content:space-between;padding:12px;background:#f8fafc;border-radius:8px;">
          <span>Usuarios activos:</span>
          <strong>{{ total_users }}</strong>
        </div>
        <div style="display:flex;justify-content:space-between;padding:12px;background:#f8fafc;border-radius:8px;">
          <span>Vocabulario total:</span>
          <strong>{{ total_glossary_entries }} palabras</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Dark theme support */
:root[data-theme="dark"] .bento-card {
  background: var(--card);
  border-color: var(--border);
}

:root[data-theme="dark"] .admin-card-link:hover div {
  background: var(--surface-2);
  border-color: var(--accent);
}

:root[data-theme="dark"] .admin-quick-btn:hover {
  background: var(--surface-2);
  border-color: var(--accent);
}

/* Modal styles */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: var(--background);
  border-radius: 16px;
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
  max-width: 90%;
  width: 100%;
}

.modal-header {
  padding: 24px 24px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--muted);
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.modal-close:hover {
  background: var(--surface-2);
  color: var(--text);
}

.modal-body {
  padding: 16px 24px 24px;
}

:root[data-theme="dark"] .modal-content {
  background: var(--card);
  border: 1px solid var(--border);
}

:root[data-theme="dark"] .modal {
  background: rgba(0,0,0,0.7);
}
</style>

<script>
function showModal(modalId) {
  document.getElementById(modalId).style.display = 'flex';
}

function hideModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });
}
</script>
{% endblock %}
