{% extends "base.html" %}
{% load static %}
{% load dict_extras %}

{% block content %}
  <h1>Tu Panel</h1>

  <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin:10px 0 16px;">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <div class="tip">Progreso total</div>
        <div style="font-size:28px;font-weight:900;" id="overall-pct">—</div>
      </div>
      <div class="gauge" id="overall-gauge" style="--val:0;"><span id="overall-gauge-t">0%</span></div>
    </div>
  </div>
  <div class="card">
    <div class="tip">Entradas en Glosario</div>
    <div style="font-size:28px;font-weight:900;">{{ glossary_count }}</div>
  </div>
  <div class="card">
    <div class="tip">Estudio</div>
    <a class="btn" href="{% url 'srs_study' %}">Continuar SRS</a>
  </div>
</div>
  <div class="stats" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:14px;">
    <div class="card">
      <div style="font-size:13px;color:#666;">Entradas en tu Glosario</div>
      <div style="font-size:28px;font-weight:700;">{{ glossary_count }}</div>
    </div>
    <div class="card">
      <div style="font-size:13px;color:#666;">Lecciones publicadas</div>
      <div style="font-size:28px;font-weight:700;">{{ lessons|length }}</div>
    </div>
    <div class="card">
      <div style="font-size:13px;color:#666;">Estudio</div>
      <a class="btn" href="{% url 'srs_study' %}">Ir a Estudiar (SRS)</a>
    </div>
  </div>

  <h3>Tus Lecciones</h3>
  <div class="lessons-grid">
    {% for lesson in lessons %}
      {% with lp=progress_map|get_item:lesson.id %}
      <div class="card">
        <h4>{{ lesson.title }}</h4>
        <p>{{ lesson.description|default:"" }}</p>

        {% if lp %}
          <div class="progress">
            <div class="bar" style="width: {{ lp.progress_percent|floatformat:0 }}%"></div>
          </div>
          <small>Progreso: {{ lp.progress_percent|floatformat:1 }}%</small><br>
          <small>Escrito: {{ lp.written_score|floatformat:1 }}% · Pronunciación: {{ lp.pronunciation_confidence|floatformat:1 }}%</small><br>
          {% if lp.completed %}
            <span class="badge">Completado</span>
          {% endif %}
        {% else %}
          <div class="progress"><div class="bar" style="width: 0%"></div></div>
          <small>Progreso: 0%</small>
        {% endif %}

        <div style="margin-top:8px;">
          <a class="btn" href="{% url 'lesson_detail' lesson.id %}">Ir a la lección</a>
        </div>
      </div>
      {% endwith %}
    {% empty %}
      <p>No hay lecciones aún.</p>
    {% endfor %}
  </div>
{% endblock %}